{% extends 'base.html' %}
{% block title %}To-do List{% endblock %}
{% block content %}
<h2>Welcome, {{ user }}</h2>
<ul>
{% for task in tasks %}
    <li>
        {% if task.completed %}
        ☑
        {% endif %}
        {% if not task.completed %}
        ☐
        {% endif %}
        {% if task.icon %}
        <img style="height:1em;margin-bottom:auto" src="/media/{{task.icon}}">
        {% endif %}
        {{ task.description | safe }}
        - <a href="{% url 'toggle_task' task.id %}">Toggle</a>
        - <a href="{% url 'delete_task' task.id %}">Delete</a>
    </li>
{% endfor %}
</ul>
<h2>Add New Task</h2>
<form action="{% url 'add_task' %}" method="post" onsubmit="return validateForm()" enctype="multipart/form-data" >
<!-- Note that it's CRITICAL to add enctype="multipart/form-data" to the form to support file upload -->
{% csrf_token %}
{{ form }}
<button type="submit">Add Task</button>
</form>

<script>
    function validateForm() {
        const descriptionField = document.getElementById('id_description');
        const descriptionValue = descriptionField.value;
        const pattern = /^[a-zA-Z0-9\s]*$/; // Allow only alphanumeric characters and spaces

        if (!pattern.test(descriptionValue)) {
            alert("Please enter a valid description without emojis or special characters.");
            return false;
        }

        return true;
    }
</script>

<hr>
    <footer>Hey there, you are using {{ browser }}</footer>
{% endblock %}
